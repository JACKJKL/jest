function Button(t){Jest.Sprite.call(this,t),t&&(t.clicked&&(this.clicked=t.clicked),t.hover&&(this.hover=t.hover)),this.over=!1,this.clickable=!0,this.noClickThrough=!0}function Cursor(t){Jest.Sprite.call(this,t)}Jest.Background=function(t){t=t||{},this.resource=t.resource||null,this.width=t.width||Jest.bounds.width,this.height=t.height||Jest.bounds.height,this.startX=t.startX||0,this.startY=t.startY||0,this.alpha=t.alpha||100;var e=32,i=32;if(this.resource&&(e=this.resource.source.width),this.resource&&(i=this.resource.source.height),this.endX=t.endX||e,this.endY=t.endY||i,this.bgIndex=t.bgIndex||0,this.pos={x:t.x||0,y:t.y||0},this.state=t.state||{id:0},this.visible=!0,this.x=this.pos.x,this.y=this.pos.y,this.scrollX=0,this.scrollY=0,this.live=!0,this.bg=!0,this.endX<this.width){var s=document.createElement("canvas"),h=s.getContext("2d"),n=this.resource.source,r=this.width-this.endX;s.width=this.endX+r,s.height=this.endY,h.drawImage(n,0,0,this.endX,this.endY,0,0,this.endX,this.endY),h.drawImage(n,0,0,r,this.endY,this.endX,0,r,this.endY),this.endX=this.endX+r,this.resource.source=s}},Jest.Background.prototype={update:function(){},scroll:function(t,e,i){this.scrollX+=t*i,this.scrollY+=e*i,this.scrollY>this.endY?this.scrollY=0:this.scrollY<0&&(this.scrollY=this.endY),this.scrollX>this.endX?this.scrollX=0:this.scrollX<0&&(this.scrollX=this.endX)},render:function(t){t.save(),t.globalAlpha=.01*this.alpha;var e=this.resource.source;if(this.startY+this.scrollY>this.endY-this.height||this.startX+this.scrollX>this.endX-this.width){var i=[this.startX+this.scrollX,this.startX],s=[this.startY+this.scrollY,this.startY],h=[this.width,this.width],n=[this.height,this.height],r=[this.pos.x,this.pos.x],a=[this.pos.y,this.pos.y],o=[this.width,this.width],d=[this.height,this.height];this.startY+this.scrollY>this.endY-this.height&&(s[0]=this.startY+this.scrollY,s[1]=this.startY,n[0]=this.endY-(this.startY+this.scrollY),n[1]=this.height,a[0]=this.pos.y,a[1]=this.pos.y+this.endY-(this.startY+this.scrollY),d[0]=this.endY-(this.startY+this.scrollY),d[1]=this.height),this.startX+this.scrollX>this.endX-this.width&&(i[0]=this.startX+this.scrollX,i[1]=this.startX,h[0]=this.endX-(this.startX+this.scrollX),h[1]=this.width,r[0]=this.pos.x,r[1]=this.pos.x+this.endX-(this.startX+this.scrollX),o[0]=this.endX-(this.startX+this.scrollX),o[1]=this.width),t.drawImage(e,i[0],s[0],h[0],n[0],r[0],a[0],o[0],d[0]),t.drawImage(e,i[1],s[1],h[1],n[1],r[1],a[1],o[1],d[1])}else t.drawImage(e,this.startX+this.scrollX,this.startY+this.scrollY,this.width,this.height,this.pos.x,this.pos.y,this.width,this.height);t.restore(),t.globalAlpha=1}},Jest.Emitter=function(t){this.live=!0,this.particleGroups=[],this.lastUpdate=(new Date).getTime(),this.startTime=(new Date).getTime(),t=t||{},this.width=t.width||Jest.bounds.width,this.height=t.height||Jest.bounds.height,this.pos=t.pos||{x:0,y:0,z:0},this.particles=[],Game.addEntity(this,!0)},Jest.Emitter.prototype={getParticles:function(){return this.particles},addGroup:function(t){t.startTime=(new Date).getTime(),t.lastUpdate=(new Date).getTime(),"undefined"==typeof t.delay&&(t.delay=0),this.particleGroups.push(t)},removeGroup:function(t){var e=this.particleGroups.length;if("String"==typeOf(t)){for(;e--;)if(t===this.particleGroups[e].name)return void this.particleGroups.splice(e,1)}else for(;e--;)if(t===this.particleGroups[e])return void this.particleGroups.splice(e,1);return!1},getGroup:function(t){var e=this.particleGroups.length;if("String"==typeOf(t)){for(;e--;)if(t===this.particleGroups[e].name)return this.particleGroups[e]}else for(;e--;)if(t===this.particleGroups[e])return this.particleGroups[e];return!1},kill:function(){this.particleGroups=[]},update:function(){this.lastUpdate=(new Date).getTime();for(var t=this.particleGroups,e=Game.Utilities,i=t.length;i--;)if(this.lastUpdate-t[i].lastUpdate>=1e3/t[i].rate&&this.lastUpdate>t[i].startTime+t[i].delay&&Game.currentFrameRate>30)if(t[i].lastUpdate=this.lastUpdate,this.lastUpdate-this.startTime<t[i].duration||-1===t[i].duration)for(p=t[i].oneShot?t[i].rate:1;p--;){t[i].x=this.pos.x,t[i].y=this.pos.y,t[i].z=this.pos.z;var s=t[i].thrustRange,h=t[i].angleRange;"undefined"!=typeof s&&("undefined"!=typeof s.max&&"undefined"!=typeof s.min?t[i].thrust=e.getRandomRange(s.min,s.max):"undefined"!=typeof s.max&&(t[i].thrust=e.getRandomRange(0,s.max))),"undefined"!=typeof h&&("undefined"!=typeof h.max&&"undefined"!=typeof h.min?t[i].angle=e.fGetRandomRange(h.min,h.max):"undefined"!=typeof h.max&&(t[i].angle=e.fGetRandomRange(0,h.max))),t[i].list=this.particles;var n=new Jest.Particle(t[i]);this.particles.push(n),Game.addEntity(n)}else this.particleGroups.splice(i,1)}},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();var Jest=function(t){t=t||{},this.renderCanvas=t.canvas||"playCanvas",this.width=t.width||320,this.height=t.height||240,this.frameRate=t.frameRate||Math.ceil(1e3/60),this.showFrameRate=t.showFrameRate||!1,this.stateName=t.stateName||"0",this.states=[],this.currentState={},this.renderer={},this.renderList=[],this.entities=[],this.intervalId={},this.lastTime=(new Date).getTime(),this.accTime=0,this.timeStep=1,this.bounds={x:0,y:0,width:this.width,height:this.height},this.frameRateLabel={},this.resourceManager=new Jest.ResourceManager,this.hitEntities=[],this.particleCount=0,Jest.frameRate=this.frameRate,Jest.bounds=this.bounds,Jest.particleCount=this.particleCount,Jest.utilities=this.utilities,Jest.states=this.states,Jest.currentState=this.currentState,Jest.focused=!0,Jest.keys=[]};Jest.prototype={load:function(){this.loaded(this)},loaded:function(t){var e=this;return this.resourceManager.loadingComplete?(t.init(),!0):(setTimeout(function(){e.loaded(t)},100),!1)},init:function(){var t=this;this.renderCanvas=document.getElementById(this.renderCanvas),null===this.renderCanvas&&(this.renderCanvas=document.createElement("canvas")),this.renderCanvas.draggable=!1,document.addEventListener("touchstart",function(e){Jest.focused=e.target!==t.renderCanvas?!1:!0}),this.renderCanvas.addEventListener("click",function(e){Jest.focused=!0,t.clicked(e,t)},!1),this.renderCanvas.addEventListener("mousemove",function(e){t.mouseMove(e,t)},!1),this.renderCanvas.addEventListener("mousedown",function(e){t.mouseDown(e,t)},!1),this.renderCanvas.addEventListener("mouseup",function(e){t.mouseUp(e,t)},!1),this.renderCanvas.addEventListener("contextmenu",function(t){t.preventDefault()},!1),this.renderCanvas.addEventListener("mousewheel",function(e){t.mouseWheel(e,t)},!1),this.renderCanvas.addEventListener("DOMMouseScroll",function(e){t.mouseWheel(e,t)},!1),document.addEventListener("keydown",function(e){Jest.focused&&t.keyDown(e,t)},!1),document.addEventListener("keyup",function(e){Jest.focused&&t.keyUp(e,t)},!1),this.renderCanvas.width=this.width,this.renderCanvas.height=this.height,this.renderer=new Jest.Renderer(this.renderCanvas),this.addState(this.stateName),this.switchState({id:0}),this.showFrameRate&&(this.frameRateLabel=new Jest.Label({text:" ",x:0,y:30,z:1,font:"14pt arial bold"}),this.addEntity(this.frameRateLabel)),this.mouseX=0,this.mouseY=0,this.moused=!1,this.leftDown=!1,this.rightDown=!1,this.midDown=!1,this.update()},update:function(){{var t=(new Date).getTime();this.update}for(this.deltaTime=t-this.lastTime,this.lastTime=t,this.accTime+=this.deltaTime,this.accTime>60&&(this.accTime=0);this.accTime>this.timeStep;){this.accTime-=this.timeStep;for(var e=this.entities,i=this.entities.length;i--;){var s=e[i];void 0!==s&&(s.live?s.update(this.timeStep/100):this.removeEntity(s))}}this.renderer.redraw(),this.frameRateLabel.text=Math.round(1e3/this.deltaTime)+" fps",this.currentFrameRate=Math.round(1e3/this.deltaTime);var h=this;requestAnimFrame(function(){h.update()})},getKey:function(t){return Jest.keys[t]},keyDown:function(t){Jest.keys[t.keyCode]=!0},keyUp:function(t){Jest.keys[t.keyCode]=!1},clicked:function(t,e){this.cX=0,this.cY=0,t.pageX||t.pageY?(this.cX=t.pageX,this.cY=t.pageY):t.changedTouches?(this.cX=t.changedTouches[0].pageX,this.cY=t.changedTouches[0].pageY):(this.cX=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.cY=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.cX-=e.renderCanvas.offsetLeft,this.cY-=e.renderCanvas.offsetTop;for(var i=e.entities.length,s=e.entities;i--;){var h=s[i];if(h.clickable&&h.pos&&h.origin&&this.cX>h.pos.x-h.origin.x&&this.cX<h.pos.x-h.origin.x+h.width&&this.cY>h.pos.y-h.origin.y&&this.cY<h.pos.y-h.origin.y+h.height&&(h.clicked(),h.noClickThrough))break}return{clickX:this.cX,clickY:this.cY}},mouseMove:function(t,e){t.pageX||t.pageY?(e.mouseX=t.pageX-e.renderCanvas.offsetLeft,e.mouseY=t.pageY-e.renderCanvas.offsetTop):(e.mouseX=t.clientX+document.body.scrollLeft-document.body.clientLeft-e.renderCanvas.offsetLeft,e.mouseY=t.clientY+document.body.scrollTop-document.body.clientTop-e.renderCanvas.offsetTop)},mouseDown:function(t,e){if(e.moused=!0,"which"in t)switch(t.which){case 1:e.leftDown=!0;break;case 2:e.midDown=!0;break;case 3:e.rightDown=!0}this.mdX=0,this.mdY=0,t.pageX||t.pageY?(this.mdX=t.pageX,this.mdY=t.pageY):(this.mdX=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mdY=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mdX-=e.renderCanvas.offsetLeft,this.mdY-=e.renderCanvas.offsetTop;for(var i=e.entities.length,s=e.entities;i--;){var h=s[i];h.clickable&&h.pos&&h.origin&&this.mdX>h.pos.x-h.origin.x&&this.mdX<h.pos.x-h.origin.x+h.width&&this.mdY>h.pos.y-h.origin.y&&this.mdY<h.pos.y-h.origin.y+h.height&&h.mouseDown()}return{mouseDownX:this.mdX,mouseDownY:this.mdY}},mouseUp:function(t,e){e.moused=!1,e.leftDown=!1,e.midDown=!1,e.rightDown=!1},mouseWheel:function(t){var e=0;return"wheelDelta"in t?e=Math.abs(t.wheelDelta)-t.wheelDelta===0?-1:1:t.detail&&(e=Math.abs(t.detail)-t.detail===0?1:-1),e},addEntity:function(t,e,i){if("live"in t||(t.live=!0),this.renderFalse=e,i){var s=this.getState(i);s&&(s.entityList.push(t),t.state=s)}else this.entities.push(t),t.state=this.currentState;e||this.renderer.addToRenderer(t)},removeEntity:function(t,e){var i=this.entities,s=i.length;if(e){var h=this.getState(e);h&&(i=h.entityList,s=i.length)}var n=i.indexOf(t);"undefined"!=typeof t.kill&&t.kill(),i.splice(n,1),this.renderer.removeFromRenderer(t),delete t},addState:function(t,e){var i={};i.name=t?t:this.states.length,i.enterState=e||void 0,i.id=this.states.length,i.renderList=[],i.entityList=[],this.states.push(i)},getState:function(t){var e=!1;if("id"in t)e=this.states[t.id];else if("name"in t)for(var i=t.name,s=0,h=this.states.length;h>s;s++)if(this.states[s].name===i){e=this.states[s];break}return e},switchState:function(t){var e=this.getState(t);e&&(t.exitTransition&&!t.exitComplete?(t.exitComplete=!0,Game.addEntity(new Jest.Transition(t.exitTransition,function(){Game.switchState(t)}))):(this.currentState=e,this.renderer.renderList=this.currentState.renderList,this.entities=this.currentState.entityList,e.enterState&&e.enterState(),t.enterTransition&&Game.addEntity(new Jest.Transition(t.enterTransition))))},checkHit:function(t,e){var i=(this.entities.length,this.entities);this.hitEntities=[];for(var s=0,h=this.entities.length;h>s;s++){var n=i[s];n.live&&n.clickable&&t>n.x&&t<n.x+n.width&&e>n.y&&e<n.y+n.height&&this.hitEntities.push(n)}}},Jest.Label=function(t){t=t||{},this.text=t.text||"Undefined Label Text",this.font=t.font||"1em Arial",this.pos={x:0,y:0},this.pos.x=t.x||0,this.pos.y=t.y||0,this.pos=t.pos||{x:this.pos.x,y:this.pos.y},this.color=t.color||"#fff",this.x=this.pos.x,this.y=this.pos.y,this.live=!0,this.visible=!0},Jest.Label.prototype={update:function(){},render:function(t){t.fillStyle=this.color,t.font=this.font,t.fillText(this.text,this.pos.x,this.pos.y)}},Jest.ParralaxBackground=function(t){this.live=!0,this.curSpeedCheck=0,this.curSpeedMult=0,this.backgrounds=[],t=t||{},this.width=t.width||Game.bounds.width,this.height=t.height||Game.bounds.height,this.state={id:0},"state"in t&&(this.state=t.state),Game.addEntity(this,!0,this.state)},Jest.ParralaxBackground.prototype.addBackground=function(t){if(!t)return!1;var e={},i=0,s=0;return t.background?(e=t.background,Game.addEntity(e,!1,this.state),t.speedMultX&&(i=t.speedMultX),t.speedMultY&&(s=t.speedMultY),void this.backgrounds.push({bg:e,speedMultX:i,speedMultY:s})):!1},Jest.ParralaxBackground.prototype.updateBackground=function(t){"undefined"!=typeof t&&"undefined"!=typeof t.bgIndex&&(t.speedMultX&&(this.backgrounds[t.bgIndex].speedMultX=t.speedMultX),t.speedMultY&&(this.backgrounds[t.bgIndex].speedMultY=t.speedMultY))},Jest.ParralaxBackground.prototype.update=function(t){for(var e=this.backgrounds.length,i=0;e>i;i++)this.backgrounds[i].bg.scroll(this.backgrounds[i].speedMultX,this.backgrounds[i].speedMultY,t)},Jest.Particle=function(t){if(Jest.Sprite.call(this,t),Jest.particleCount++,this.startLife=(new Date).getTime(),this.curStep=0,t=t||{},this.lifeTime=void 0!==t.lifeTime?t.lifeTime:1e3,this.delay=t.delay||0,this.size=t.size||1,this.width=this.height=this.size,this.startSize=t.startSize||this.size,this.endSize=void 0!==t.endSize?t.endSize:this.size,this.thrust=t.thrust||0,this.gravity=t.gravity||0,this.angle=t.angle||0,this.angleChange=t.angleChange||0,this.alignToAngle=t.alignToAngle||!1,this.drawAngle=t.drawAngle||0,this.drawAngleChange=t.drawAngleChange||0,this.startColor=t.startColor||this.color,this.endColor=t.endColor||this.color,this.startAlpha=void 0!==t.startAlpha?t.startAlpha:1,this.endAlpha=void 0!==t.endAlpha?t.endAlpha:1,this.blend=t.blend||!1,this.origin.y=this.height/2,this.origin.x=this.width/2,this.endLife=this.startLife+this.lifeTime,this.colors=[],this.endColor!==this.startColor)for(var e=Math.ceil(this.lifeTime/Jest.frameRate)+1;e>-1;e--)this.colors.push(this.colorFade(this.startColor,this.endColor,this.lifeTime,e*Jest.frameRate))},Jest.Particle.prototype=new Jest.Sprite,Jest.Particle.prototype.update=function(t){if(this.curStep=this.endLife-(new Date).getTime(),this.vel.x=Math.cos(this.angle*Math.PI/180)*this.thrust*t,this.vel.y=(Math.sin(this.angle*Math.PI/180)*this.thrust+this.gravity*(this.lifeTime-this.curStep)*t)*t,this.pos.x+=this.vel.x,this.pos.y+=this.vel.y,(this.pos.y<0||this.pos.y>Jest.bounds.y+Jest.bounds.height)&&(this.live=!1,Jest.particleCount--),(new Date).getTime()>this.endLife&&(this.live=!1,Jest.particleCount--),this.endAlpha!==this.startAlpha&&(this.alpha=this.endAlpha>this.startAlpha?(this.startAlpha-this.endAlpha)/this.lifeTime*this.curStep:this.endAlpha+(this.startAlpha-this.endAlpha)/this.lifeTime*this.curStep),this.endColor!==this.startColor&&(this.color=this.colors[Math.ceil((this.lifeTime-this.curStep)/Jest.frameRate)]),this.endSize!==this.size){var e=0;this.endSize<this.startSize?(e=(this.startSize-this.endSize)/this.lifeTime*this.curStep,this.scale={x:-e,y:-e}):(e=this.endSize+(this.startSize-this.endSize)/this.lifeTime*this.curStep,this.scale={x:-e,y:-e})}this.angleChange&&(this.angle+=this.angleChange*t),this.drawAngleChange&&(this.drawAngle+=this.drawAngleChange*t),this.alignToAngle&&(this.drawAngle=this.angle)},Jest.Particle.prototype.render=function(t){t.save();var e=this.scale||{x:0,y:0},i=this.pos.x,s=this.pos.y,h=this.origin.x,n=this.origin.y,r=this.width,a=this.height,o=this.drawAngle*Math.PI/180;if(this.blend&&(t.globalCompositeOperation="lighter"),this.shape){var d=this.color||{r:0,g:0,b:0};t.fillStyle="rgba("+d.r+","+d.g+","+d.b+","+this.alpha+")",0!==this.drawAngle?(t.translate(i,s),t.rotate(o),t.fillRect(-h,-n,r-e.x,a-e.y)):t.fillRect(i-h,s-n,r-e.x,a-e.y)}else t.globalAlpha=this.alpha,0!==this.drawAngle?(t.translate(i,s),t.rotate(o),t.drawImage(this.resource.source,this.startX,this.startY,r,a,e.x/2,e.y/2,r-e.x,a-e.y)):t.drawImage(this.resource.source,this.startX,this.startY,r,a,i-h,s-n,r-e.x,a-e.y);t.restore(),t.globalCompositeOperation="source-over"},Jest.Particle.prototype.colorFade=function(t,e,i,s){var h=s/i,n=e.r+h*(t.r-e.r);return b=e.b+h*(t.b-e.b),g=e.g+h*(t.g-e.g),{r:Math.floor(Math.min(255,Math.max(0,n))),g:Math.floor(Math.min(255,Math.max(0,g))),b:Math.floor(Math.min(255,Math.max(0,b)))}},Jest.Renderer=function(t){this.renderList=[],this.canvas=t,this.context=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height},Jest.Renderer.prototype={redraw:function(){this.context.clearRect(0,0,this.width,this.height),this.renderList.sort(function(t,e){return t.bg&&e.bg?e.bgIndex-t.bgIndex:t.ui&&e.ui?e.uiIndex-t.uiIndex:t.bg||e.ui?1:e.bg||t.ui?-1:t.pos&&e.pos?e.pos.z-t.pos.z:0});for(var t=this.renderList.length;t--;){var e=this.renderList[t];e.visible&&e.render(this.context)}},addToRenderer:function(t){this.renderList.push(t)},removeFromRenderer:function(t){var e=this.renderList,i=e.indexOf(t);-1!==i&&e.splice(e.indexOf(t),1)}},Jest.Resource=function(t,e){1==e||"img"==e||null===e?this.source=new Image:(2==e||"audio"==e)&&(this.source=new Audio),this.source.src=t},Jest.Resource.prototype.changeResource=function(t){this.source.src=t},Jest.ResourceManager=function(){this.resources=[],this.loaded=0,this.loadingComplete=!0},Jest.ResourceManager.prototype={add:function(t,e,i){var s={path:t,type:e,name:i};return t.src&&(s.path=t.src),this.loadingComplete=!1,void 0===i&&(i=""),1==e||"img"==e||null===e?(s.source=1===t.nodeType?t:new Image,this.resources.push({resource:s,name:i}),s.source.onload=function(t,e){s.loaded=!0,t.loadImg(t,e)}(this,s),s.source.src=1===t.nodeType?t.src:t):(2==e||"audio"==e)&&(s.source=new Audio,this.resources.push({resource:s,name:i}),this.loadAudio(s),s.source.src=t),s},loadImg:function(t,e){e.source.complete&&e.source.width?(t.loaded++,t.loaded===t.resources.length&&(t.loadingComplete=!0)):setTimeout(function(){t.loadImg(t,e)},10)},loadAudio:function(t,e){clearTimeout(e),e=0;var i=this;t.source.readyState>0?(this.loaded++,this.loaded===this.resources.length&&(this.loadingComplete=!0)):e=setTimeout(function(){i.loadAudio(t,e)},100)},getResource:function(t){for(var e=this.resources,i=0,s=e.length;s>i;i++)if(e[i].name==t)return e[i].resource}},function(t,e,i,s,h,n,r){function a(t){var e,s,h=this,n=t.length,r=0,a=h.c=h.d=h.f=0;for(h.a=[],h.e=[],n||(t=[n++]);i>r;)h.a[r]=r++;for(r=0;i>r;r++)e=h.a[r],a=c(a+e+t[r%n]),s=h.a[a],h.a[r]=s,h.a[a]=e;h.b=function(t){var e=h.a,s=c(h.c+1),n=e[s],r=c(h.d+n),a=e[r];e[s]=a,e[r]=n;for(var o=e[c(n+a)];--t;)s=c(s+1),n=e[s],r=c(r+n),a=e[r],e[s]=a,e[r]=n,o=o*i+e[c(n+a)];return h.c=s,h.d=r,o},h.b(i)}function o(t,e,i,s){if(i=[],e&&"object"==typeof t)for(s in t)if(s.indexOf("S")<5)try{i.push(o(t[s],e-1))}catch(h){}return i.length?i:""+t}function d(t,e,i,s){for(t+="",s=i=0;s<t.length;s++)e[c(s)]=c((i^=19*e[c(s)])+t.charCodeAt(s));t="";for(s in e)t+=String.fromCharCode(e[s]);return t}function c(t){return t&i-1}e.seedrandom=function(c,l){var u,p=[];return c=d(o(l?[c,t]:arguments.length?c:[(new Date).getTime(),t,window],3),p),u=new a(p),d(u.a,t),e.random=function(){for(var t=u.b(s),e=r,a=0;h>t;)t=(t+a)*i,e*=i,a=u.b(1);for(;t>=n;)t/=2,e/=2,a>>>=1;return(t+a)/e},c},r=e.pow(i,s),h=e.pow(2,h),n=2*h,d(e.random(),t)}([],Math,256,6,52),Jest.Sprite=function(t){if(t=t||{},this.width=t.width||32,this.height=t.height||32,this.pos=t.pos||{x:0,y:0,z:0},t.x&&t.y){var e=0;t.z&&(e=t.z),this.pos=new Vector(t.x,t.y,e)}else this.pos=t.pos?t.pos:new Vector(0,0,0);if(this.origin=t.origin||{x:0,y:0,z:0},t.ox&&t.oy){var i=0;t.oz&&(i=t.oz),this.origin=new Vector(t.ox,t.oy,i)}else this.origin=t.origin?t.origin:new Vector(0,0,0);if(this.vel=t.vel||{x:0,y:0,z:0},t.vx&&t.vy){var s=0;t.vz&&(s=t.vz),this.vel=new Vector(t.vx,t.vy,s)}else this.vel=t.vel?t.vel:new Vector(0,0,0);this.startX=t.startX||0,this.startY=t.startY||0,this.tileable=t.tileable||!1,this.tileable&&(this.endX=t.endX||this.width,this.endY=t.endY||this.height),void 0===t.resource?(this.shape=!0,this.resource={}):(this.shape=!1,this.resource=t.resource),this.angle=t.angle||0,this.thrust=t.thrust||0,this.color=t.color||{r:255,g:255,b:255},this.alpha=255,this.clickable=t.clickable||!1,t.list&&"undefined"!=t.list.length?(this.list=t.list,this.list.push(this)):this.list=[],this.visible=!0,this.animations=[],this.curAnim={name:"",frames:0},this.isAnimating=!1,this.lastAnim=0,this.animSpeed=0,this.x=this.pos.x,this.y=this.pos.y,this.live=!0},Jest.Sprite.prototype={update:function(){this.isAnimating&&(new Date).getTime()>this.lastAnim+this.animSpeed&&(this.lastAnim=(new Date).getTime(),this.startX=this.width*this.curAnim.frames[this.frame],this.frame++,this.frame>this.curAnim.frames.length-1&&(1!==this.animType?this.isAnimating=!1:this.frame=0))},addAnimation:function(t,e){var i={name:e,frames:t};this.animations.push(i)},playAnimation:function(t,e,i){for(var s=0,h=this.animations.length;h>s;s++){var n=this.animations[s];n.name===t&&(this.curAnim=n,this.animSpeed=e,this.animType="undefined"==typeof i?0:i,this.frame=0,this.isAnimating=!0)}},stopAnimation:function(){this.isAnimating&&(this.isAnimating=!1,this.curAnim={name:"",frames:0})},checkCollision:function(){},changeFrame:function(t){this.startX=t*this.width},kill:function(){if(this.list.length>0){var t=(this.list.length,this.list),e=t.indexOf(this);e&&t.splice(e,1)}},render:function(t){if(t.save(),this.shape){var e=this.color;t.fillStyle="rgba("+e.r+","+e.g+","+e.b+","+this.alpha+")",t.fillRect(this.pos.x-this.origin.x,this.pos.y-this.origin.y,this.width,this.height)}else{var i=.5+(this.pos.x-this.origin.x)<<0,s=.5+(this.pos.y-this.origin.y)<<0;t.drawImage(this.resource.source,this.startX,this.startY,this.width,this.height,i,s,this.width,this.height)}t.restore()},clicked:function(){},mouseDown:function(){}},Jest.Transition=function(t,e){this.callback=e?e:function(){return!0},this.effect="fadeOut",this.duration=1e3,this.start=(new Date).getTime(),void 0!==t&&(t.effect&&(this.effect=t.effect),t.duration&&(this.duration=t.duration)),this.timeStep=this.duration/Game.frameRate,this.steps=this.duration/Game.frameRate,this.curStep=0,this.visible=!0,this.live=!0,Game.addEntity(this)},Jest.Transition.prototype={update:function(){this.complete&&(Game.renderCanvas.style.cursor="default",this.live=!1,this.callback())},render:function(t){switch(this.effect){case"fadeOut":t.globalAlpha=1-1/this.timeStep*this.curStep;break;case"fadeIn":t.globalAlpha=1/this.timeStep*this.curStep}this.curStep++,this.curStep>=this.steps&&(this.complete=!0)}},Object.merge=function(){return[].reduce.call(arguments,function(t,e){return Object.keys(e).forEach(function(i){t[i]=e[i]}),t},{})},Jest.prototype.Utilities={getRandomRange:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},fGetRandomRange:function(t,e){return Math.random()*(e-t)+t},getDistance:function(t,e){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y))},getAngle:function(t,e){var i=e.x-t.x,s=e.y-t.y,h=Math.atan2(s,i),n=h/Math.PI*180;return n},getRad:function(t,e){var i=e.x-t.x,s=e.y-t.y,h=Math.atan2(s,i);return h},colCheck:function(t,e){var i=t.pos.x+t.width/2-(e.pos.x+e.width/2),s=t.pos.y+t.height/2-(e.pos.y+e.height/2),h=t.width/2+e.width/2,n=t.height/2+e.height/2,r=!1,a={x:0,y:0};if(Math.abs(i)<h&&Math.abs(s)<n){var o=h-Math.abs(i),d=n-Math.abs(s);o>=d?s>0?a.y+=d:a.y-=d:i>0?a.x+=o:a.x-=o}return(0!==a.x||0!==a.y)&&(r=!0),{collision:r,offset:a}},mouse:function(t){return t.pageX||t.pageY?{x:t.pageX,y:t.pageY}:{x:t.clientX+document.body.scrollLeft-document.body.clientLeft,y:t.clientY+document.body.scrollTop-document.body.clientTop}},getGradColor:function(t,e,i,s){var h=-(s-i)/6,n=t.r+h*(e.r-t.r);return b=t.b+h*(e.b-t.b),g=t.g+h*(e.g-t.g),"rgb("+Math.floor(Math.min(255,Math.max(0,n)))+","+Math.floor(Math.min(255,Math.max(0,g)))+","+Math.floor(Math.min(255,Math.max(0,b)))+")"},preCalcRotation:function(t,e,i,s,h,n){if(1===t.nodeType){var r=t;t={},t.source=r}var a=document.createElement("canvas"),o=a.getContext("2d"),d=document.createElement("canvas"),c=d.getContext("2d"),l=t.source.width/i,u=360/e;startAngle=0,h&&(startAngle=h),a.width=t.source.width,a.height=Math.ceil(360*s/u),d.width=i,d.height=s;for(var p=0;e>p;p++)for(var f=0;l>f;f++)c.clearRect(0,0,i,s),c.save(),c.translate(d.width/2,d.height/2),c.rotate((startAngle+u*p)*Math.PI/180),c.drawImage(t.source,f*i,0,i,s,-i/2,-s/2,i,s),c.restore(),o.drawImage(d,0,0,i,s,f*i,p*s,i,s);if(n){var m=new Image;m.onload=function(){document.body.appendChild(this)},m.src=a.toDataURL()}return t.source=a,a},colorize:function(t,e){var i=document.createElement("canvas"),s=i.getContext("2d");i.width=t.source.width,i.height=t.source.height,s.drawImage(t.source,0,0);for(var h=s.getImageData(0,0,i.width,i.height),n=h.data,r=e.h,a=e.s,o=e.v,d=0,c=n.length;c>d;d+=4){var e=this.rgbhsv({r:n[d],g:n[d+1],b:n[d+2]});e.h+=r,e.h<0?e.h=0:e.h>360&&(e.h=360),e.s+=a,e.v+=o;var l=this.hsvrgb(e);n[d]=l.r,n[d+1]=l.g,n[d+2]=l.b}return s.putImageData(h,0,0),i.toDataURL()},rgbhsv:function(t){var e=t.r,i=t.g,s=t.b,h=Math.max(e,i,s),n=Math.min(e,i,s),r=0,a=0,o=0;return h==n?r=0:h==e?r=60*((i-s)/(h-n))%360:h==i?r=60*((s-e)/(h-n))+120:h==s&&(r=60*((e-i)/(h-n))+240),o=h,a=0==h?0:1-n/h,{h:r,s:a,v:o}},hsvrgb:function(t){var e=t.h,i=t.s,s=t.v,h={r:0,g:0,b:0},n=Math.floor(e/60)%6,r=e/60-Math.floor(e/60),a=s*(1-i),o=s*(1-r*i),d=s*(1-(1-r)*i);switch(n){case 0:h.r=s,h.g=d,h.b=a;break;case 1:h.r=o,h.g=s,h.b=a;break;case 2:h.r=a,h.g=s,h.b=d;break;case 3:h.r=a,h.g=o,h.b=s;break;case 4:h.r=d,h.g=a,h.b=s;break;case 5:h.r=s,h.g=a,h.b=o}return h}}(function(){function t(e,i,s){this.x=e,this.y=i,this.z=s,copy=function(t){this.x=t.x,this.y=t.y,this.z=t.z},add=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},sub=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},cross=function(t){this.tx=this.x,this.ty=this.y,this.tz=this.z,this.x=this.ty*t.z-this.tz*t.y,this.y=this.tz*t.x-this.tx*t.z,this.z=this.tx*t.y-this.ty*t.x},multiply=function(t){this.x*=t,this.y*=t,this.z*=t},distanceTo=function(t){return this.dx=this.x-t.x,this.dy=this.y-t.y,this.dz=this.z-t.z,Math.sqrt(this.dx*this.dx+this.dy*this.dy+this.dz*this.dz)},distanceToSquared=function(t){return this.dx=this.x-t.x,this.dy=this.y-t.y,this.dz=this.z-t.z,this.dx*this.dx+this.dy*this.dy+this.dz*this.dz},length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},negate=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},clone=function(){return new t(this.x,this.y,this.z)},toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"}}this.Vector=t,t.prototype={add:function(e,i){return new t(e.x+i.x,e.y+i.y,e.z+i.z)},sub:function(e,i){return new t(e.x-i.x,e.y-i.y,e.z-i.z)},negate:function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},multiply:function(e,i){return new t(e.x*i,e.y*i,e.z*i)},cross:function(e,i){return new t(e.y*i.z-e.z*i.y,e.z*i.x-e.x*i.z,e.x*i.y-e.y*i.x)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},distance:function(t,e){var i=t.x-e.x,s=t.y-e.y,h=t.z-e.z;return Math.sqrt(i*i+s*s+h*h)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},mulScale:function(e,i){return new t(this.x*i,this.y*i,this.z*i)},normalize:function(){return this.ool=this.length()>0?1/this.length():0,this.x*=this.ool,this.y*=this.ool,this.z*=this.ool,this}}})(),Button.prototype=new Jest.Sprite,Button.prototype.clicked=function(){Sprite.prototype.clicked(),this.clicked&&this.visible&&this.clicked()},Button.prototype.mouseover=function(t){this.hover&&this.visible&&this.hover(t)},Button.prototype.update=function(){if(Jest.Sprite.prototype.update(),this.visible){var t=this.pos.x-this.origin.x,e=this.pos.y-this.origin.y;Game.mouseX>t&&Game.mouseX<t+this.width&&Game.mouseY>e&&Game.mouseY<e+this.height?(this.over=!0,this.mouseover(this.over)):this.over&&(this.over=!1,this.mouseover(this.over))}},Cursor.prototype=new Jest.Sprite,Cursor.prototype.update=function(){Jest.Sprite.prototype.update(),this.pos.x=Game.mouseX,this.pos.y=Game.mouseY},Jest.UI=function(t){t=t||{},this.state=t.state||Game.currentState,this.width=t.width||Game.bounds.width,this.height=t.height||Game.bounds.height,this.items=[],Game.addEntity(this,!0,this.state)},Jest.UI.prototype={addItem:function(t,e){void 0===e&&(e=1),t.ui=!0,t.uiIndex=e,Game.addEntity(t,!1,this.state),this.items.push(t)},hide:function(){for(var t=this.items.length;t--;)this.items[t].visible=!1,this.items[t].clickable=!1},show:function(){for(var t=this.items.length;t--;)this.items[t].visible=!0,this.items[t].clickable=!0},update:function(){},render:function(){}};