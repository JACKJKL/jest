!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.r(t);var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resources=[],this.loaded=0,this.loadingComplete=!0}var t,i,s;return t=e,(i=[{key:"add",value:function(e,t,i){var n,s,r={path:e,type:t,name:i};return e.src&&(r.path=e.src),this.loadingComplete=!1,void 0===i&&(i=""),1==t||"img"==t||null===t?(1===e.nodeType?r.source=e:r.source=new Image,this.resources.push({resource:r,name:i}),r.source.onload=(n=this,s=r,r.loaded=!0,void n.loadImg(n,s)),1===e.nodeType?r.source.src=e.src:r.source.src=e):2!=t&&"audio"!=t||(r.source=new Audio,this.resources.push({resource:r,name:i}),this.loadAudio(r),r.source.src=e),r}},{key:"loadImg",value:function(e,t){t.source.complete&&t.source.width?(e.loaded++,e.loaded===e.resources.length&&(e.loadingComplete=!0)):setTimeout(function(){e.loadImg(e,t)},10)}},{key:"loadAudio",value:function(e,t){clearTimeout(t),t=0;var i=this;e.source.readyState>0?(this.loaded++,this.loaded===this.resources.length&&(this.loadingComplete=!0)):t=setTimeout(function(){i.loadAudio(e,t)},100)}},{key:"getResource",value:function(e){for(var t=this.resources,i=0,n=t.length;i<n;i++)if(t[i].name==e)return t[i].resource}}])&&n(t.prototype,i),s&&n(t,s),e}();function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.renderList=[],this.canvas=t,this.context=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height}var t,i,n;return t=e,(i=[{key:"redraw",value:function(){this.context.clearRect(0,0,this.width,this.height),this.renderList.sort(function(e,t){return e.bg&&t.bg?t.bgIndex-e.bgIndex:e.ui&&t.ui?t.uiIndex-e.uiIndex:e.bg||t.ui?1:t.bg||e.ui?-1:e.pos&&t.pos?t.pos.z-e.pos.z:0});for(var e=this.renderList.length;e--;){var t=this.renderList[e];t.visible&&t.render(this.context)}}},{key:"addToRenderer",value:function(e){this.renderList.push(e)}},{key:"removeFromRenderer",value:function(e){var t=this.renderList;-1!==t.indexOf(e)&&t.splice(t.indexOf(e),1)}}])&&r(t.prototype,i),n&&r(t,n),e}();function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{},this.text=t.text||"Undefined Label Text",this.font=t.font||"1em Arial",this.pos={x:0,y:0},this.pos.x=t.x||0,this.pos.y=t.y||0,this.pos=t.pos||{x:this.pos.x,y:this.pos.y},this.color=t.color||"#fff",this.x=this.pos.x,this.y=this.pos.y,this.live=!0,this.visible=!0}var t,i,n;return t=e,(i=[{key:"update",value:function(e){}},{key:"render",value:function(e){e.fillStyle=this.color,e.font=this.font,e.fillText(this.text,this.pos.x,this.pos.y)}}])&&o(t.prototype,i),n&&o(t,n),e}();function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.d(t,"default",function(){return c});var c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=t||{},this.renderCanvas=t.canvas||"playCanvas",this.width=t.width||320,this.height=t.height||240,this.frameRate=t.frameRate||Math.ceil(1e3/60),this.showFrameRate=t.showFrameRate||!1,this.stateName=t.stateName||"0",this.states=[],this.currentState={},this.renderer={},this.renderList=[],this.entities=[],this.intervalId={},this.lastTime=Date.now(),this.accTime=0,this.timeStep=1,this.bounds={x:0,y:0,width:this.width,height:this.height},this.frameRateLabel={},this.resourceManager=new s,this.hitEntities=[],this.particleCount=0,e.frameRate=this.frameRate,e.bounds=this.bounds,e.particleCount=this.particleCount,e.utilities=this.utilities,e.states=this.states,e.currentState=this.currentState,e.focused=!0,e.keys=[]}var t,i,n;return t=e,(i=[{key:"load",value:function(){this.loaded(this)}},{key:"loaded",value:function(e){var t=this;return this.resourceManager.loadingComplete?(e.init(),!0):(setTimeout(function(){t.loaded(e)},100),!1)}},{key:"update",value:function(){var e=Date.now();this.update;for(this.deltaTime=e-this.lastTime,this.lastTime=e,this.accTime+=this.deltaTime,this.accTime>60&&(this.accTime=0);this.accTime>this.timeStep;){this.accTime-=this.timeStep;for(var t=this.entities,i=this.entities.length;i--;){var n=t[i];void 0!==n&&(n.live?n.update(this.timeStep/100):this.removeEntity(n))}}this.renderer.redraw(),this.frameRateLabel.text=Math.round(1e3/this.deltaTime)+" fps",this.currentFrameRate=Math.round(1e3/this.deltaTime);var s=this;requestAnimationFrame(function(){s.update()})}},{key:"init",value:function(){var t=this;this.renderCanvas=document.getElementById(this.renderCanvas),null===this.renderCanvas&&(this.renderCanvas=document.createElement("canvas")),this.renderCanvas.draggable=!1,document.addEventListener("touchstart",function(i){i.target!==t.renderCanvas?e.focused=!1:e.focused=!0}),this.renderCanvas.addEventListener("click",function(i){e.focused=!0,t.clicked(i,t)},!1),this.renderCanvas.addEventListener("mousemove",function(e){t.mouseMove(e,t)},!1),this.renderCanvas.addEventListener("mousedown",function(e){t.mouseDown(e,t)},!1),this.renderCanvas.addEventListener("mouseup",function(e){t.mouseUp(e,t)},!1),this.renderCanvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.renderCanvas.addEventListener("mousewheel",function(e){t.mouseWheel(e,t)},!1),this.renderCanvas.addEventListener("DOMMouseScroll",function(e){t.mouseWheel(e,t)},!1),document.addEventListener("keydown",function(i){e.focused&&t.keyDown(i,t)},!1),document.addEventListener("keyup",function(i){e.focused&&t.keyUp(i,t)},!1),this.renderCanvas.width=this.width,this.renderCanvas.height=this.height,this.renderer=new a(this.renderCanvas),this.addState(this.stateName),this.switchState({id:0}),this.showFrameRate&&(this.frameRateLabel=new h({text:" ",x:0,y:30,z:1,font:"14pt arial bold"}),this.addEntity(this.frameRateLabel)),this.mouseX=0,this.mouseY=0,this.moused=!1,this.leftDown=!1,this.rightDown=!1,this.midDown=!1,this.update()}},{key:"getKey",value:function(t){return e.keys[t]}},{key:"keyDown",value:function(t,i){e.keys[t.keyCode]=!0}},{key:"keyUp",value:function(t,i){e.keys[t.keyCode]=!1}},{key:"clicked",value:function(e,t){this.cX=0,this.cY=0,e.pageX||e.pageY?(this.cX=e.pageX,this.cY=e.pageY):e.changedTouches?(this.cX=e.changedTouches[0].pageX,this.cY=e.changedTouches[0].pageY):(this.cX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.cY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.cX-=t.renderCanvas.offsetLeft,this.cY-=t.renderCanvas.offsetTop;for(var i=t.entities.length,n=t.entities;i--;){var s=n[i];if(s.clickable&&s.pos&&s.origin&&this.cX>s.pos.x-s.origin.x&&this.cX<s.pos.x-s.origin.x+s.width&&this.cY>s.pos.y-s.origin.y&&this.cY<s.pos.y-s.origin.y+s.height&&(s.clicked(),s.noClickThrough))break}return{clickX:this.cX,clickY:this.cY}}},{key:"mouseMove",value:function(e,t){e.pageX||e.pageY?(t.mouseX=e.pageX-t.renderCanvas.offsetLeft,t.mouseY=e.pageY-t.renderCanvas.offsetTop):(t.mouseX=e.clientX+document.body.scrollLeft-document.body.clientLeft-t.renderCanvas.offsetLeft,t.mouseY=e.clientY+document.body.scrollTop-document.body.clientTop-t.renderCanvas.offsetTop)}},{key:"mouseDown",value:function(e,t){if(t.moused=!0,"which"in e)switch(e.which){case 1:t.leftDown=!0;break;case 2:t.midDown=!0;break;case 3:t.rightDown=!0}this.mdX=0,this.mdY=0,e.pageX||e.pageY?(this.mdX=e.pageX,this.mdY=e.pageY):(this.mdX=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,this.mdY=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),this.mdX-=t.renderCanvas.offsetLeft,this.mdY-=t.renderCanvas.offsetTop;for(var i=t.entities.length,n=t.entities;i--;){var s=n[i];s.clickable&&s.pos&&s.origin&&this.mdX>s.pos.x-s.origin.x&&this.mdX<s.pos.x-s.origin.x+s.width&&this.mdY>s.pos.y-s.origin.y&&this.mdY<s.pos.y-s.origin.y+s.height&&s.mouseDown()}return{mouseDownX:this.mdX,mouseDownY:this.mdY}}},{key:"mouseUp",value:function(e,t){t.moused=!1,t.leftDown=!1,t.midDown=!1,t.rightDown=!1}},{key:"mouseWheel",value:function(e,t){var i=0;return"wheelDelta"in e?i=Math.abs(e.wheelDelta)-e.wheelDelta==0?-1:1:e.detail&&(i=Math.abs(e.detail)-e.detail==0?1:-1),i}},{key:"addEntity",value:function(e,t,i){if("live"in e||(e.live=!0),this.renderFalse=t,i){var n=this.getState(i);n&&(n.entityList.push(e),e.state=n)}else this.entities.push(e),e.state=this.currentState;t||this.renderer.addToRenderer(e)}},{key:"removeEntity",value:function(e,t){var i=this.entities;i.length;if(t){var n=this.getState(t);n&&(i=n.entityList).length}var s=i.indexOf(e);void 0!==e.kill&&e.kill(),i.splice(s,1),this.renderer.removeFromRenderer(e)}},{key:"addState",value:function(e,t,i){var n={};n.name=e||this.states.length,n.enterState=t||void 0,n.id=this.states.length,n.renderList=[],n.entityList=[],this.states.push(n)}},{key:"getState",value:function(e){var t=!1;if("id"in e)t=this.states[e.id];else if("name"in e)for(var i=e.name,n=0,s=this.states.length;n<s;n++)if(this.states[n].name===i){t=this.states[n];break}return t}},{key:"switchState",value:function(t){var i=this.getState(t);i&&(t.exitTransition&&!t.exitComplete?(t.exitComplete=!0,Game.addEntity(new e.Transition(t.exitTransition,function(){Game.switchState(t)}))):(this.currentState=i,this.renderer.renderList=this.currentState.renderList,this.entities=this.currentState.entityList,i.enterState&&i.enterState(),t.enterTransition&&Game.addEntity(new e.Transition(t.enterTransition))))}},{key:"checkHit",value:function(e,t){this.entities.length;var i=this.entities;this.hitEntities=[];for(var n=0,s=this.entities.length;n<s;n++){var r=i[n];r.live&&r.clickable&&e>r.x&&e<r.x+r.width&&t>r.y&&t<r.y+r.height&&this.hitEntities.push(r)}}}])&&u(t.prototype,i),n&&u(t,n),e}()}]);
//# sourceMappingURL=app.js.map